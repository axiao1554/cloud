var isfetched=false;var isXml=true;var search_path="search.xml";if(search_path.length===0){search_path="search.xml"}else{if(/json$/i.test(search_path)){isXml=false}}var path="/"+search_path;var onPopupClose=function(a){$(".popup").hide();$("#local-search-input").val("");$(".search-result-list").remove();$("#no-result").remove();$(".local-search-pop-overlay").remove();$("body").css("overflow","")};function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden");$(".search-popup-overlay").click(onPopupClose);$(".popup").toggle();var a=$("#local-search-input");a.attr("autocapitalize","none");a.attr("autocorrect","off");a.focus()}var searchFunc=function(c,a,b){$("body").append('<div class="search-popup-overlay local-search-pop-overlay">'+'<div id="search-loading-icon">'+'<span class="fa-q fa-aq-b-spinner fa-aq-b-pulse fa-5x"></span>'+"</div>"+"</div>").css("overflow","hidden");$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center");$.ajax({url:c,dataType:isXml?"xml":"json",async:true,success:function(f){isfetched=true;$(".popup").detach().appendTo(".local-search-inner");var d=isXml?$("entry",f).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():f;var e=document.getElementById(a);var h=document.getElementById(b);var g=function(){var k=e.value.trim().toLowerCase();var i=k.split(/[\s\-]+/);if(i.length>1){i.push(k)}var l=[];if(k.length>0){d.forEach(function(F){var w=false;var G=0;var r=0;var H=F.title.trim();var C=H.toLowerCase();var x=F.content.trim().replace(/<[^>]+>/g,"");var B=x.toLowerCase();var v=decodeURIComponent(F.url).replace(/\/{2,}/g,"/");var p=[];var o=[];if(H!=""){i.forEach(function(I){function J(P,Q,L){var M=P.length;if(M===0){return[]}var O=0,K=[],N=[];if(!L){Q=Q.toLowerCase();P=P.toLowerCase()}while((K=Q.indexOf(P,O))>-1){N.push({position:K,word:P});O=K+M}return N}p=p.concat(J(I,C,false));o=o.concat(J(I,B,false))});if(p.length>0||o.length>0){w=true;G=p.length+o.length}}if(w){[p,o].forEach(function(I){I.sort(function(J,K){if(K.position!==J.position){return K.position-J.position}else{return J.word.length-K.word.length}})});function D(P,K,L,O){var R=O[O.length-1];var N=R.position;var J=R.word;var M=[];var I=0;while(N+J.length<=L&&O.length!=0){if(J===k){I++}M.push({position:N,length:J.length});var Q=N+J.length;O.pop();while(O.length!=0){R=O[O.length-1];N=R.position;J=R.word;if(Q>N){O.pop()}else{break}}}r+=I;return{hits:M,start:K,end:L,searchTextCount:I}}var y=[];if(p.length!=0){y.push(D(H,0,H.length,p))}var s=[];while(o.length!=0){var A=o[o.length-1];var E=A.position;var z=A.word;var q=E-20;var n=E+80;if(q<0){q=0}if(n<E+z.length){n=E+z.length}if(n>x.length){n=x.length}s.push(D(x,q,n,o))}s.sort(function(J,I){if(J.searchTextCount!==I.searchTextCount){return I.searchTextCount-J.searchTextCount}else{if(J.hits.length!==I.hits.length){return I.hits.length-J.hits.length}else{return J.start-I.start}}});var u=parseInt("1");if(u>=0){s=s.slice(0,u)}function t(L,K){var I="";var J=K.start;K.hits.forEach(function(N){I+=L.substring(J,N.position);var M=N.position+N.length;I+='<b class="search-keyword">'+L.substring(N.position,M)+"</b>";J=M});I+=L.substring(J,K.end);return I}var m="";if(y.length!=0){m+="<li><a href='"+v+"' class='search-result-title' target='_blank'>"+t(H,y[0])+"</a>"}else{m+="<li><a href='"+v+"' class='search-result-title' target='_blank'>"+H+"</a>"}s.forEach(function(I){m+="<a href='"+v+"' target='_blank'>"+'<p class="search-result">'+t(x,I)+"...</p>"+"</a>"});m+="</li>";l.push({item:m,searchTextCount:r,hitCount:G,id:l.length})}})}if(i.length===1&&i[0]===""){h.innerHTML='<div id="no-result"><span class="fa fa-aq-b-search fa-5x"></span></div>'}else{if(l.length===0){h.innerHTML='<div id="no-result"><span class="fa fa-aq-b-o fa-5x"></span></div>'}else{l.sort(function(n,m){if(n.searchTextCount!==m.searchTextCount){return m.searchTextCount-n.searchTextCount}else{if(n.hitCount!==m.hitCount){return m.hitCount-n.hitCount}else{return m.id-n.id}}});var j='<ul class="search-result-list">';l.forEach(function(m){j+=m.item});j+="</ul>";h.innerHTML=j}}};if("auto"==="auto"){e.addEventListener("input",g)}else{$(".search-icon").click(g);e.addEventListener("keypress",function(i){if(i.keyCode===13){g()}})}$(".local-search-pop-overlay").remove();$("body").css("overflow","");proceedsearch()}})};$(".popup-btn-close").click(onPopupClose);$(".popup").click(function(a){a.stopPropagation()});$(document).on("keyup",function(b){var a=b.which===27&&$(".search-popup").is(":visible");if(a){onPopupClose()}});